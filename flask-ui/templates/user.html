{% extends 'base.html' %}
{% block title %}{{ username }}’s Public Trackers{% endblock %}

{% block content %}
<div class="container mx-auto px-6 py-8">
  <h2 class="text-3xl font-bold mb-6 text-gray-800">
    {{ username }}’s Trackers
  </h2>
  <button id="friends-btn"
          class="text-blue-600 hover:underline text-sm mb-6">
    <span id="friend-count">…</span> friends
  </button>

  <!-- View‐Range Controls -->
  <div class="flex items-center space-x-4 mb-6">
    <div class="space-x-2">
      <label class="inline-flex items-center">
        <input type="radio" name="viewRange" value="week" checked
               class="form-radio text-blue-500"/>
        <span class="ml-2">This Week</span>
      </label>
      <label class="inline-flex items-center">
        <input type="radio" name="viewRange" value="month"
               class="form-radio text-blue-500"/>
        <span class="ml-2">This Month</span>
      </label>
      <label class="inline-flex items-center">
        <input type="radio" name="viewRange" value="year"
               class="form-radio text-blue-500"/>
        <span class="ml-2">Last 365</span>
      </label>
    </div>
  </div>

  {% if trackers %}
    <div id="calendar-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for t in trackers %}
        <div
          class="tracker-card bg-white rounded-lg shadow p-4"
          data-tracker-id="{{ t.id }}"
          data-aggregate='{{ t.aggregate | tojson }}'
          data-rule='{{ t.rule      | tojson }}'
          data-color="{{ t.color }}"
          data-widget-type="{{ t.widget_type }}"
        >
          <h3 class="text-xl font-semibold mb-2">
            {{ t.name }}
          </h3>
          <p class="text-sm mb-4 text-gray-600 no-select">
            {% for period, count in t.rule.items() %}
              {{ count }}× {{ period.replace('_',' ') }}
            {% endfor %}
          </p>
          <div class="calendar grid grid-cols-7 gap-2"></div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-gray-600">No trackers to show.</p>
  {% endif %}
</div>

<script>
  // signal to calendar.js that we're on a public profile
  window.PUBLIC_USERNAME = "{{ username|e }}";
</script>
<script id="initial-trackers" type="application/json">
  {{ trackers | tojson | safe }}
</script>
<script src="/static/js/calendar.js"></script>

<style>
  .no-select {
    -webkit-touch-callout: none !important;   /* no long-press menu */
    -webkit-user-drag: none !important;       /* no drag start */
    -webkit-user-select: none !important;     /* Safari/Chrome */
    -moz-user-select: none !important;        /* Firefox */
    -ms-user-select: none !important;         /* IE10+ */
    user-select: none !important;             /* Standard */
  }
</style>

<script>
  document.querySelectorAll('.no-select').forEach(el => {
    // Prevent mouse/touch from ever starting text selection
    el.addEventListener('mousedown',  e => e.preventDefault());
    el.addEventListener('touchstart', e => e.preventDefault(), { passive: false });
    // Prevent the context menu (long-press) on iOS
    el.addEventListener('contextmenu', e => e.preventDefault());
  });
</script>
{% endblock %}